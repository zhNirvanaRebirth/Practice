# 例行性工作流程  
## 工作的分类  
* 例行性工作（使用crontab指令）  
* 临时性工作（使用at指令）  
## Linux上常见的例行性工作  
* 进行登录档的轮替：由于系统会一直激励登录信息，所以登录文件会越来越大，大型的文件有占用过大容量和影响读写效率的问题，所以系统会适时地将旧的登录资料和新的登录资料分开存放，以更有效的记录登录信息  
* 登录文件分析logwatch的任务：当系统发生了软件问题、硬件错误、资料安全问题时，系统就会将这些错误信息记录到登录档中，logwatch会主动去分析登录咨询  
* 建立locate的资料库：我们的文件名资料库是放置到/var/lib/mlocate中，这个资料库的自动更新就是系统主动进行updatedb的结果  
* man page查询资料库的建立：man page资料库中更新，是系统主动进行mandb的结果  
* RPM软件登录档的建立：系统可能会更改软件（包括软件的新安装，非经常性的更新等），会造成软件档名的差异，系统通过排程来进行RPM资料库的重新建置  
* 移除暂存档：当一个软件关闭时，软件在运作的时候产生的暂存档可能不会主动被移除，但是过一段时间，系统为了清理磁盘容量，会主动调用tmpwatch指令来删除这些暂存档  
* 网络服务有关的分析行为：系统会主动分析一下网络服务软件的登录档等信息  
## 仅执行一次的工作排程  
### atd  
> 使用单一工作排程，Linux系统上对这个排程负责的服务  
  
* systemctl restart atd:重启atd服务  
* systemctl enable atd:让这个服务开机就自动启动  
* systemctl status atd:查看atd目前的状态  
### at的运作方式  
> 我们使用at这个指令产生要运作的工作，并将这个工作以文字档的方式写入/var/spool/at/目录中，该工作就能等待atd这个服务来取用了  
  
**因为保证系统安全的缘故，我们需要限制能够使用at的用户，我们通过/etc/at.allow和/etc/at.deny两个文档来限制**  
1. 先找寻/etc/at.allow这个文档，写在这个文档中的使用者才能使用at指令，否则不能使用at指令（即使使用者不在at.deny文档中）  
2. 如果/etc/at.allow不存在，就找寻/etc/at.deny文档，写在这个文档中的用户不能使用at指令，其余的可以使用at指令  
3. 如果这两个文档都不存在，就只有root可以使用at指令  


### batch  
> 在系统有空时运行背景任务（在cpu工作负载小于0.8时，才执行相关的背景工作）  
  
**at和crontab工作的最小单位都是分钟，就是每分钟检查一次，也就是在整分之后才能执行**  
## 循环执行的例行性工作排程  
### cron(crond)  
> Linux系统上使用来控制例行性工作排程的服务  
  
### 使用者的设定  
> 我们使用crontab指令建立工作排程之后，该工作就被记录到/var/spool/cron/目录下，而且是通过账号来判别的；同时，cron执行的每一项工作都会被记录到/var/log/cron文档中  
  
同样由于安全性问题，我们需要限制使用crontab指令的使用者，限制如下：  
1. 先找寻/etc/cron.allow这个文档，写在这个文档中的使用者才能使用crontab指令，否则不能使用crontab指令（即使使用者不在cron.deny文档中）  
2. 如果/etc/cron.allow不存在，就找寻/etc/cron.deny文档，写在这个文档中的用户不能使用crontab指令，其余的可以使用crontab指令  
3. 如果这两个文档都不存在，就只有root可以使用crontab指令  
### 系统例行性工作排程设定档：/etc/crontab,/etc/cron.d/*  
> cron服务会每分钟一次去读取/etc/crontab与/var/spool/cron里面的资料内容来执行  
  
> crond服务会每分钟一次去读取/etc/crontab、/etc/cron.d/*与/etc/spool/cron/*中的设定档资料来执行  
  
## 可唤醒关机期间的工作任务  
### anacron  
> 用于处理非24小时开机的Linux系统上的crontab的执行以及因为某些原因导致的超过时间而没有被执行的排程工作  
  
anacron是每小时被crond执行一次，然后anacron再去检查相关的排程有没有被执行，如果有超过期限的工作，就执行它，若执行完毕或者没有任何超时排程，anacron就停止了