# Linux核心编译与管理  
## Kernel  
> 核心(Kernel)是整个操作系统的最底层，其负责了整个硬件的驱动，以及提供各种系统所需的核心功能，包括防火墙机制，是否支援LVM会Quota等文件系统等，也就是说，核心的工作是控制硬件，如果核心不认识硬件（就是没有该硬件的驱动），我们就不能使用该硬件  
  
* 核心是系统上的一个文件，这个文件中包含了驱动主机各项硬件的侦测程序与驱动模块  
* 核心模块(kernel module):将不常用的类似于驱动的程序编译成模块，核心在系统正常运行的过程中可以载入这个模块到核心，这使得kernel可以使用新的硬件而不需要重新编译kernel  
* 使用指令"make mrproper"清除核心源码中的目标文件和设定文件，同时也会删除核心功能的选择文件（就是使用make xxconfig选择编译的核心功能）  
* 使用指令"make clean"删除目标文件等编译过程中产生的中间文件，而不会删除设定文件  
### 选择核心功能  
> 在/boot/目录下有一个config-xxx文件，这个文件就是核心功能列表文件，在编译的过程中，根据该文件进行核心功能的选择，最终在我们的核心编译目录下生成一个.config隐藏文件，我们可以通过以下操作生成/boot/config-xxx文件  
  
* make menuconfig:图形界面的配置方式  
* make oldconfig：通过已有的./.config文件内容，使用该文件内的设置为预设值，只将新版本核心内的新功能列出让使用者选择  
* make xconfig：通过Qt为图形界面基础功能的图形化界面显示，需要X window的支援  
* make gconfig：通过Gtk为图形界面基础功能的图形界面显示，需要X window的支援  
* make config：每个项目都一条一条的列出来让选择  
### 核心的编译与安装  
* make vmlinux：编译未经压缩的核心  
* make modules：仅编译核心模块  
* make bzImage：编译经过压缩的核心  
* make all：编译上述三个动作  
* make modules_install：安装模块（模块放置的目录：/lib/modules/$(uname -r)/目录下）  
### 安装核心与多重核心选单  
> 系统核心应该放在/boot/目录下，且开头为vmlinuz,因此我们需要将编译的核心移动到/boot/目录下，并进行相关的处理  
  
1. 移动核心到/boot目录下并保留旧的核心文件  
2. 建立对应的Initial Ram Disk(initrd)  
3. 编辑开机选单(grub)  
4. 以新核心开机、测试、修改  
### 额外核心模块编译  
> 额外模块一般就是驱动程序，额外的核心模块会依据核心的版本，被放置到/lib/modules/$(uname -r)/kernel/目录下，硬件驱动程序会被放置到/lib/modules/$(uname -r)/kernel/drivers/目录下  
  
我们在使用硬件商提供的模块来进行编译的时候，通常需要使用到核心提供的头文件来取得驱动模块需要的一些函数库，所以，我们在编译核心模块时，需要用到核心的源码，源码可能的位置：/usr/src/或/usr/src/linux/目录下，目前核心使用连接文件来指向正确的核心源码文件，我们可以查看/lib/module/$(uname -r)/build及/lib/modules/$(uname -r)/source这两个文件所连接的正确核心源码位置  
